# Gudu SQLFlow Lite version for docker

### サーバー起動

```bash
docker run -d \
  -p 8000:8000 \
  --name sqlflow \
  ghcr.io/suwa-sh/python_data_lineage_docker:latest

open http://localhost:8000
```

### データリネージ分析

```bash
docker run -it --rm \
  -v /path/to/your/sql:/app/sql \
  ghcr.io/suwa-sh/python_data_lineage_docker:latest \
  /t oracle /f sql/your_file.sql /graph

# 実行中のコンテナで起動する場合
docker exec -it sqlflow \
  /t oracle /f test.sql /graph
```

- 引数

  ```sh
    /t: Required, specify the database type
      
      The valid value: access,bigquery,couchbase,dax,db2,greenplum, gaussdb, hana,hive,impala,informix,mdx,mssql,
          sqlserver,mysql,netezza,odbc,openedge,oracle,postgresql,postgres,redshift,snowflake,
          sybase,teradata,soql,vertica 

      the default value is oracle

    /f: optional, The SQL file that needs to be processed, if this option is not specified, /d must be speicified.

    /d: optional, All SQL files under this directory will be processed.

    /j: optional, The analyzed result will include the join relationship.

    /s: optional, Ignore the intermediate results of the output data lineage.

    /topselectlist: optional, output the column in select list. this option valid only /s is specified.

    /withTemporaryTable: optional, only valid use with /s option, including the data lineage of temporary table used in the SQL.

    /i: optional, this option work almost the same as /s option, but will keep the data lineage generated by function call.

    /if: optional, keep all the intermediate result in the output data lineage, but remove the result derived from function call.

    /ic: optional, ignore the coordinate in the output.

    /lof: optional, if a column in the SQL is not qualifiey with a table name, and multiple tables are used in the from clause, then, the column will be linked to the first table in from clause.

    /traceView: optional, only list source table and view, ignore all intermediate result.

    /json: optional, ouput in json format.

    /tableLineage [/csv /delimiter]: optional, only output data lineage at table level.

    /csv: optional, output the data lineage in CSV format.

    /delimiter: optional, specify the separate character used in CSV output.

    /env: optional, specify a metadata.json to provide the metadata that can be used during SQL analysis.

    /transform: optional, includind the code that do the transform.

    /coor: optional, whether including the coordinate in the output.

    /defaultDatabase: optional, specify a default database.

    /defaultSchema: optional, specify a default schema.

    /showImplicitSchema: optional, Display the schema information inferred from the SQL statement.

    /showConstant: optional, whether show constant.

    /treatArgumentsInCountFunctionAsDirectDataflow: optional,treate column used in count function as a direct dataflow.

    /filterRelationTypes: optional, supported types: fdd，fdr，join，call，er，seperated by comma if multiple values are specified.

    /graph: optional, automatically open web browser to show the data lineage diagram.
    /er: optional, automatically open web browser to show the ER diagram.
  ```

### 一括データリネージ分析

指定ディレクトリ直下の全サブディレクトリに対して、データリネージ分析をディレクトリモード（/d）で実行します。

```bash
docker run --rm \
  -v /path/to/your/projects:/app/projects \
  ghcr.io/suwa-sh/python_data_lineage_docker:latest \
  bulk_dlineage projects/ [dlineage-options]

# 実行中のコンテナで起動する場合
docker exec -it sqlflow \
  bulk_dlineage /path/to/directories [dlineage-options]
```

### DELETE/TRUNCATE文抽出

SQLファイルからDELETE文とTRUNCATE文を抽出してCSV形式で出力します。

```bash
docker run --rm \
  -v /path/to/your/sql:/app/sql \
  -v /path/to/output:/app/output \
  ghcr.io/suwa-sh/python_data_lineage_docker:latest \
  analyze_delete sql/your_file.sql --output output/

# 実行中のコンテナで起動する場合
docker exec -it sqlflow \
  analyze_delete test.sql --output output/
```

- 出力例：`元ファイル名_delete.csv`
  ```csv
  ファイル,delete/truncate,テーブル,条件
  test.sql,delete,emp,empno = 7369
  test.sql,truncate,temp_table,-
  ```

### SQL分割

複雑なSQLファイルをDDL、CTE、サブクエリ、メインクエリに分割します。

```bash
docker run --rm \
  -v /path/to/your/sql:/app/sql \
  -v /path/to/output:/app/output \
  ghcr.io/suwa-sh/python_data_lineage_docker:latest \
  split sql/your_file.sql output/

# 実行中のコンテナで起動する場合
docker exec -it sqlflow \
  split test.sql output/
```

- 出力ファイル例：
  - `元ファイル名_01.sql` - DDL文
  - `元ファイル名_02.sql` - CTE（WITH句）
  - `元ファイル名_03.sql` - 抽出されたサブクエリ
  - `元ファイル名_main.sql` - メインクエリ
